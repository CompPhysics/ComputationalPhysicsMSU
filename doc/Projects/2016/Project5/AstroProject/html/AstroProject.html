<!--
Automatically generated HTML file from DocOnce source
(https://github.com/hplgit/doconce/)
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/" />
<meta name="description" content="Project 5, deadline  December 9, 2016">

<title>Project 5, deadline  December 9, 2016</title>


<style type="text/css">
/* bloodish style */

body {
  font-family: Helvetica, Verdana, Arial, Sans-serif;
  color: #404040;
  background: #ffffff;
}
h1 { font-size: 1.8em;  color: #8A0808; }
h2 { font-size: 1.6em;  color: #8A0808; }
h3 { font-size: 1.4em;  color: #8A0808; }
h4 { color: #8A0808; }
a { color: #8A0808; text-decoration:none; }
tt { font-family: "Courier New", Courier; }
/* pre style removed because it will interfer with pygments */
p { text-indent: 0px; }
hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
p.caption { width: 80%; font-style: normal; text-align: left; }
hr.figure { border: 0; width: 80%; border-bottom: 1px solid #aaa}

div { text-align: justify; text-justify: inter-word; }
</style>


</head>

<!-- tocinfo
{'highest level': 2,
 'sections': [('Theoretical background and description of the system',
               2,
               None,
               '___sec0'),
              ('Project 5a): Extension of project 3', 3, None, '___sec1'),
              ('Project 5b): Time to reach equilibrium', 3, None, '___sec2'),
              ('Project 5c): Kinetic and potential energy',
               3,
               None,
               '___sec3'),
              ('Project 5d): Numerical instabilities', 3, None, '___sec4'),
              ('Project 5e): Test of the virial theorem', 3, None, '___sec5'),
              ('Project 5f): Density of particles', 3, None, '___sec6'),
              ('References', 3, None, '___sec7'),
              ('Function for Gaussian random numbers', 3, None, '___sec8'),
              ('Introduction to numerical projects', 2, None, '___sec9'),
              ('Format for electronic delivery of report and programs',
               2,
               None,
               '___sec10')]}
end of tocinfo -->

<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "AMS"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



    
<!-- ------------------- main content ---------------------- -->



<center><h1>Project 5, deadline  December 9, 2016</h1></center>  <!-- document title -->

<p>
<!-- author(s): Astronomy project, \( N \)-body simulation of an open galactic cluster -->

<center>
<b>Astronomy project, \( N \)-body simulation of an open galactic cluster</b> 
</center>

<p>
<!-- institution(s) -->

<br>
<p>
<center><h4>Fall semester 2016</h4></center> <!-- date -->
<br>

<h2 id="___sec0">Theoretical background and description of the system </h2>

<p>
The goal of this project is to develop a code that can perform
simulations of an open cluster using Newtonian gravity. 
This project is inspired by an article by
<a href="http://dx.doi.org/10.1063/1.3462740" target="_blank">M. Joyce and co-workers</a>, see also the references below.  When solving this
project, we recommend downloading this article. It is a good companion
to understand the physics discussed here.
This project requires a good  background in cosmology and
astrophysics. The project can be seen as a continuation of project 3 and we will use again
the Velocity Verlet algorithm.

<p>
We will try to build a simple model of an open
cluster, as done by <a href="http://dx.doi.org/10.1063/1.3462740" target="_blank">M. Joyce and co-workers</a>. An
open cluster is a group of up to a few thousand gravitationally bound
stars created from the collapse of a molecular cloud. This collapse
leads to a flurry of star formation. Open clusters are usually found
in the arms of spiral galaxies, or in irregular galaxies. Since stars
in an open cluster have roughly the same age, and are made from the
same material, they are interesting in the study of stellar evolution,
since many of the variable parameters we have when comparing two stars
are kept constant.

<p>
Once open clusters are formed they gradually dissipate as members get
ejected from the cluster due to random collisions, this means that
open clusters generally last only a few hundred million years. In
the figure here we see the Hertzsprung-Russell diagrams for two open
clusters.

<p>
<center>  <!-- FIGURE -->
<hr class="figure">
<center><p class="caption">Figure 1:  Hertzsprung-Russell diagrams for two open clusters, M67 and   NGC 188. We see that most of the stars are on the main sequence. In   the older cluster, NGC 188, we see that the heaviest stars are just   now leaving the main sequence, while the younger cluster, M67. </p></center>
<p><img src="open_cluster_hr_diagram_ages.png" align="bottom" width=400></p>
</center>

<p>
We will study a simple model for how an open cluster is made from
the gravitational collapse and interaction among a large number of
stars. We want to study this collapse, and the statistical properties
of the collapsed system.
We will simulate what is called a
<em>cold collapse</em>, this means that we start the particles with little
or no initial velocity. You will also find it useful to start with the code you developed in project 3.

<h3 id="___sec1">Project 5a): Extension of project 3  </h3>

<p>
Extend your code from project 3 to an arbitrary number of particles, \( N \),
  starting with a uniform (random) distribution within a sphere of a
  given radius \( R_0 \). Start the particles at rest, with masses
  randomly distributed by a Gaussian distribution around ten solar
  masses with a standard deviation of one solar mass. Use solar masses
  and light years as units of mass and length and make your equations dimensionless.
This function is included below and  can be used to generate 
random numbers which follow a Gaussian (or normal) distribution.  Alternatively, you can use 
the <em>random</em> class in c++ and generate random numbers according to the normal distribution.

<p>
How large time steps are required given \( R_0 = 20 \) ly
(light years), and  \( N = 100 \)? Do we have any units of time that fit
this timescale?   
In the limit where \( N \rightarrow \infty \), keeping \( \rho_0 \) constant,
we get a continuous fluid. In this case the system collapses into a
singularity at a finite time \( \tau_{\mathrm{crunch}} = \sqrt{\frac{3\pi}{32G\rho_0}} \).

<p>
Why do we not observe this singularity in our model? Use
\( \tau_{\mathrm{crunch}} \) as the unit of time, and find \( G \) in these units (\( G \)
will become a function of the number of particles \( N \), and the average
mass of the particles, \( \mu \)).

<h3 id="___sec2">Project 5b): Time to reach equilibrium  </h3>

Run the system for a few \( \tau_{\mathrm{crunch}} \). Save the positions
  of the particles at different times to file. Does the system
  reach an equilibrium? How long time does this take?

<h3 id="___sec3">Project 5c): Kinetic and potential energy  </h3>

Make a function that calculates the kinetic and potential
  energy of the system. Is the energy conserved? Some of the
  particles are ejected from the system, how can we identify these
  particles from the energies we have calculated? How much of the
  energy of the system is taken away by particle ejection? How does
  this change with different values of \( N \)? Are there still particles
  being ejected after the system reaches equilibrium?

<h3 id="___sec4">Project 5d): Numerical instabilities  </h3>

We will now introduce a smoothing function to take care of
  the numerical instability that arises when two of the particles come
  very close. There are a lot of ways of inserting such a smoothing, but
  we will just look at a very simple one. We will modify the Newtonian
  force law to make it finite at short ranges

$$
\begin{equation*} 
F_{mod} = -\frac{GM_1M_2}{r^2 + \epsilon^2}.
\end{equation*}
$$

<p>
The parameter \( \epsilon \) is a <em>small</em> real constant. What should the value of this parameter be? Try out different values (which one gives you the best energy conservation?). Can we justify this correction to the pure Newtonian force by noting that our particles do not represent actual point particles
but rather mass distributions of some finite extent? Does the addition
of this correction change any of the results from the previous exercise?

<h3 id="___sec5">Project 5e): Test of the virial theorem  </h3>

Now we will look at the particles that are bound (not ejected). 
What is the distribution of potential and kinetic energy?

<p>
The virial theorem says that for a bound gravitational system in
equilibrium we have

$$
\begin{equation*}
2\langle K\rangle = -\langle V \rangle,
\end{equation*}
$$

where \( \langle K\rangle \)
is the average (over time) kinetic energy of the system and $ \langle V
\rangle$ is the average potential energy.

<p>
By the ergodic hypothesis we can take an ensemble 
average (average over a large system) instead of the time average.

<p>
Are your results consistent with the virial theorem?

<h3 id="___sec6">Project 5f): Density of particles  </h3>

Try to plot the radial density of the particles (the particle density as a function of radius) in the
  equilibrium state. How would you extract such an information from your calculations? (Hint: make a histogram for the radial
particle density) What is the average distance? What is the
  standard deviation? Plot the radial distribution of particles.

<p>
Run the code for different number of initial particles, keeping the
total mass constant. The interpretation of one particle as one or a few stars will not be useful any more when you increase the number of particles beyond a few thousand, however the analysis of gravitationally bound systems of many particles have much broader applications than cold collapse of open clusters, so the results are still highly relevant. What is the average distance from the centre of the cluser as a function of \( N \)?

<p>
The radial distribution of particles in this kind of cold collapse can often be fit very well with the simple expression

$$
\begin{equation*} 
n(r) = \frac{n_0}{\left(1 +\left(\frac{r}{r_0}\right)^4\right)}.
\end{equation*}
$$

Try to fit your data to this curve, what is the value \( n_0 \) and \( r_0 \)? Can you find how these values depend on N?

<p>
How many particles can you simulate?

<p>
Compare your results with those found in  <a href="http://dx.doi.org/10.1063/1.3462740" target="_blank">M. Joyce and co-workers</a>.

<p>
If you want, you can also compare your results to the well-known Navarro-Frenk-White profile

$$
\begin{equation*} 
\rho(r) = \frac{\rho_0}{\frac{r}{r_0}\left(1 +\frac{r}{r_0}\right)^2}.
\end{equation*}
$$

Does this give a  better fit?

<h3 id="___sec7">References </h3>

<ol>
<li> <a href="http://dx.doi.org/10.1063/1.3462740" target="_blank">M. Joyce, B. Marcos, and F. Sylos Labini, Cold uniform spherical collapse revisited, AIP Conf. Proc. 1241, 955 (2010)</a>. See also <a href="http://arxiv.org/abs/1011.0614" target="_blank">arXiv1011.0614 (2011)</a>.</li>
<li> P. J. E. Peebles, <em>The Large-Scale Structure of the Universe</em>, Princeton University Press, 1980. See also C. Payne-Gaposchkin,  <em>Stars and clusters</em>, (Cambridge, Harvard University Press, 1979).</li>
<li> A. Friedman,  On the Curvature of Space,  General Relativity and Gravitation 31,  1991 (1999)":"http://link.springer.com/article/10.1023%2FA%3A1026751225741".</li>
</ol>

<h3 id="___sec8">Function for Gaussian random numbers </h3>

<p>

<!-- code=c++ (!bc cppcod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #408080; font-style: italic">// ran2 for uniform deviates, initialize with negative seed.</span>
<span style="color: #B00040">double</span> <span style="color: #0000FF">ran2</span>(<span style="color: #B00040">long</span> <span style="color: #666666">*</span>);

<span style="color: #408080; font-style: italic">// function for gaussian random numbers</span>
<span style="color: #B00040">double</span> <span style="color: #0000FF">gaussian_deviate</span>(<span style="color: #B00040">long</span> <span style="color: #666666">*</span>);

<span style="color: #408080; font-style: italic">/*</span>
<span style="color: #408080; font-style: italic">** The function </span>
<span style="color: #408080; font-style: italic">**         ran2()</span>
<span style="color: #408080; font-style: italic">** is a long periode (&gt; 2 x 10^18) random number generator of </span>
<span style="color: #408080; font-style: italic">** L&#39;Ecuyer and Bays-Durham shuffle and added safeguards.</span>
<span style="color: #408080; font-style: italic">** Call with idum a negative integer to initialize; thereafter,</span>
<span style="color: #408080; font-style: italic">** do not alter idum between sucessive deviates in a</span>
<span style="color: #408080; font-style: italic">** sequence. RNMX should approximate the largest floating point value</span>
<span style="color: #408080; font-style: italic">** that is less than 1.</span>
<span style="color: #408080; font-style: italic">** The function returns a uniform deviate between 0.0 and 1.0</span>
<span style="color: #408080; font-style: italic">** (exclusive of end-point values).</span>
<span style="color: #408080; font-style: italic">*/</span>

<span style="color: #BC7A00">#define IM1 2147483563</span>
<span style="color: #BC7A00">#define IM2 2147483399</span>
<span style="color: #BC7A00">#define AM (1.0/IM1)</span>
<span style="color: #BC7A00">#define IMM1 (IM1-1)</span>
<span style="color: #BC7A00">#define IA1 40014</span>
<span style="color: #BC7A00">#define IA2 40692</span>
<span style="color: #BC7A00">#define IQ1 53668</span>
<span style="color: #BC7A00">#define IQ2 52774</span>
<span style="color: #BC7A00">#define IR1 12211</span>
<span style="color: #BC7A00">#define IR2 3791</span>
<span style="color: #BC7A00">#define NTAB 32</span>
<span style="color: #BC7A00">#define NDIV (1+IMM1/NTAB)</span>
<span style="color: #BC7A00">#define EPS 1.2e-7</span>
<span style="color: #BC7A00">#define RNMX (1.0-EPS)</span>

<span style="color: #B00040">double</span> <span style="color: #0000FF">ran2</span>(<span style="color: #B00040">long</span> <span style="color: #666666">*</span>idum)
{
  <span style="color: #B00040">int</span>            j;
  <span style="color: #B00040">long</span>           k;
  <span style="color: #008000; font-weight: bold">static</span> <span style="color: #B00040">long</span>    idum2 <span style="color: #666666">=</span> <span style="color: #666666">123456789</span>;
  <span style="color: #008000; font-weight: bold">static</span> <span style="color: #B00040">long</span>    iy<span style="color: #666666">=0</span>;
  <span style="color: #008000; font-weight: bold">static</span> <span style="color: #B00040">long</span>    iv[NTAB];
  <span style="color: #B00040">double</span>         temp;

  <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #666666">*</span>idum <span style="color: #666666">&lt;=</span> <span style="color: #666666">0</span>) {
    <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #666666">-</span>(<span style="color: #666666">*</span>idum) <span style="color: #666666">&lt;</span> <span style="color: #666666">1</span>) <span style="color: #666666">*</span>idum <span style="color: #666666">=</span> <span style="color: #666666">1</span>;
    <span style="color: #008000; font-weight: bold">else</span>             <span style="color: #666666">*</span>idum <span style="color: #666666">=</span> <span style="color: #666666">-</span>(<span style="color: #666666">*</span>idum);
    idum2 <span style="color: #666666">=</span> (<span style="color: #666666">*</span>idum);
    <span style="color: #008000; font-weight: bold">for</span>(j <span style="color: #666666">=</span> NTAB <span style="color: #666666">+</span> <span style="color: #666666">7</span>; j <span style="color: #666666">&gt;=</span> <span style="color: #666666">0</span>; j<span style="color: #666666">--</span>) {
      k     <span style="color: #666666">=</span> (<span style="color: #666666">*</span>idum)<span style="color: #666666">/</span>IQ1;
      <span style="color: #666666">*</span>idum <span style="color: #666666">=</span> IA1<span style="color: #666666">*</span>(<span style="color: #666666">*</span>idum <span style="color: #666666">-</span> k<span style="color: #666666">*</span>IQ1) <span style="color: #666666">-</span> k<span style="color: #666666">*</span>IR1;
      <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #666666">*</span>idum <span style="color: #666666">&lt;</span> <span style="color: #666666">0</span>) <span style="color: #666666">*</span>idum <span style="color: #666666">+=</span>  IM1;
      <span style="color: #008000; font-weight: bold">if</span>(j <span style="color: #666666">&lt;</span> NTAB)  iv[j]  <span style="color: #666666">=</span> <span style="color: #666666">*</span>idum;
    }
    iy<span style="color: #666666">=</span>iv[<span style="color: #666666">0</span>];
  }
  k     <span style="color: #666666">=</span> (<span style="color: #666666">*</span>idum)<span style="color: #666666">/</span>IQ1;
  <span style="color: #666666">*</span>idum <span style="color: #666666">=</span> IA1<span style="color: #666666">*</span>(<span style="color: #666666">*</span>idum <span style="color: #666666">-</span> k<span style="color: #666666">*</span>IQ1) <span style="color: #666666">-</span> k<span style="color: #666666">*</span>IR1;
  <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #666666">*</span>idum <span style="color: #666666">&lt;</span> <span style="color: #666666">0</span>) <span style="color: #666666">*</span>idum <span style="color: #666666">+=</span> IM1;
  k     <span style="color: #666666">=</span> idum2<span style="color: #666666">/</span>IQ2;
  idum2 <span style="color: #666666">=</span> IA2<span style="color: #666666">*</span>(idum2 <span style="color: #666666">-</span> k<span style="color: #666666">*</span>IQ2) <span style="color: #666666">-</span> k<span style="color: #666666">*</span>IR2;
  <span style="color: #008000; font-weight: bold">if</span>(idum2 <span style="color: #666666">&lt;</span> <span style="color: #666666">0</span>) idum2 <span style="color: #666666">+=</span> IM2;
  j     <span style="color: #666666">=</span> iy<span style="color: #666666">/</span>NDIV;
  iy    <span style="color: #666666">=</span> iv[j] <span style="color: #666666">-</span> idum2;
  iv[j] <span style="color: #666666">=</span> <span style="color: #666666">*</span>idum;
  <span style="color: #008000; font-weight: bold">if</span>(iy <span style="color: #666666">&lt;</span> <span style="color: #666666">1</span>) iy <span style="color: #666666">+=</span> IMM1;
  <span style="color: #008000; font-weight: bold">if</span>((temp <span style="color: #666666">=</span> AM<span style="color: #666666">*</span>iy) <span style="color: #666666">&gt;</span> RNMX) <span style="color: #008000; font-weight: bold">return</span> RNMX;
  <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">return</span> temp;
}
<span style="color: #BC7A00">#undef IM1</span>
<span style="color: #BC7A00">#undef IM2</span>
<span style="color: #BC7A00">#undef AM</span>
<span style="color: #BC7A00">#undef IMM1</span>
<span style="color: #BC7A00">#undef IA1</span>
<span style="color: #BC7A00">#undef IA2</span>
<span style="color: #BC7A00">#undef IQ1</span>
<span style="color: #BC7A00">#undef IQ2</span>
<span style="color: #BC7A00">#undef IR1</span>
<span style="color: #BC7A00">#undef IR2</span>
<span style="color: #BC7A00">#undef NTAB</span>
<span style="color: #BC7A00">#undef NDIV</span>
<span style="color: #BC7A00">#undef EPS</span>
<span style="color: #BC7A00">#undef RNMX</span>

<span style="color: #408080; font-style: italic">// End: function ran2()</span>



<span style="color: #408080; font-style: italic">// random numbers with gaussian distribution</span>
<span style="color: #B00040">double</span> <span style="color: #0000FF">gaussian_deviate</span>(<span style="color: #B00040">long</span> <span style="color: #666666">*</span> idum)
{
  <span style="color: #008000; font-weight: bold">static</span> <span style="color: #B00040">int</span> iset <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
  <span style="color: #008000; font-weight: bold">static</span> <span style="color: #B00040">double</span> gset;
  <span style="color: #B00040">double</span> fac, rsq, v1, v2;

  <span style="color: #008000; font-weight: bold">if</span> ( idum <span style="color: #666666">&lt;</span> <span style="color: #666666">0</span>) iset <span style="color: #666666">=0</span>;
  <span style="color: #008000; font-weight: bold">if</span> (iset <span style="color: #666666">==</span> <span style="color: #666666">0</span>) {
    <span style="color: #008000; font-weight: bold">do</span> {
      v1 <span style="color: #666666">=</span> <span style="color: #666666">2.*</span>ran2(idum) <span style="color: #666666">-1.0</span>;
      v2 <span style="color: #666666">=</span> <span style="color: #666666">2.*</span>ran2(idum) <span style="color: #666666">-1.0</span>;
      rsq <span style="color: #666666">=</span> v1<span style="color: #666666">*</span>v1<span style="color: #666666">+</span>v2<span style="color: #666666">*</span>v2;
    } <span style="color: #008000; font-weight: bold">while</span> (rsq <span style="color: #666666">&gt;=</span> <span style="color: #666666">1.0</span> <span style="color: #666666">||</span> rsq <span style="color: #666666">==</span> <span style="color: #666666">0.</span>);
    fac <span style="color: #666666">=</span> sqrt(<span style="color: #666666">-2.*</span>log(rsq)<span style="color: #666666">/</span>rsq);
    gset <span style="color: #666666">=</span> v1<span style="color: #666666">*</span>fac;
    iset <span style="color: #666666">=</span> <span style="color: #666666">1</span>;
    <span style="color: #008000; font-weight: bold">return</span> v2<span style="color: #666666">*</span>fac;
  } <span style="color: #008000; font-weight: bold">else</span> {
    iset <span style="color: #666666">=0</span>;
    <span style="color: #008000; font-weight: bold">return</span> gset;
  }
} <span style="color: #408080; font-style: italic">// end function for gaussian deviates</span>
</pre></div>

<h2 id="___sec9">Introduction to numerical projects </h2>

<p>
Here follows a brief recipe and recommendation on how to write a report for each
project.

<ul>
  <li> Give a short description of the nature of the problem and the eventual  numerical methods you have used.</li>
  <li> Describe the algorithm you have used and/or developed. Here you may find it convenient to use pseudocoding. In many cases you can describe the algorithm in the program itself.</li>
  <li> Include the source code of your program. Comment your program properly.</li>
  <li> If possible, try to find analytic solutions, or known limits in order to test your program when developing the code.</li>
  <li> Include your results either in figure form or in a table. Remember to        label your results. All tables and figures should have relevant captions        and labels on the axes.</li>
  <li> Try to evaluate the reliabilty and numerical stability/precision of your results. If possible, include a qualitative and/or quantitative discussion of the numerical stability, eventual loss of precision etc.</li>
  <li> Try to give an interpretation of you results in your answers to  the problems.</li>
  <li> Critique: if possible include your comments and reflections about the  exercise, whether you felt you learnt something, ideas for improvements and  other thoughts you've made when solving the exercise. We wish to keep this course at the interactive level and your comments can help us improve it.</li>
  <li> Try to establish a practice where you log your work at the  computerlab. You may find such a logbook very handy at later stages in your work, especially when you don't properly remember  what a previous test version  of your program did. Here you could also record  the time spent on solving the exercise, various algorithms you may have tested or other topics which you feel worthy of mentioning.</li>
</ul>

<h2 id="___sec10">Format for electronic delivery of report and programs </h2>

<p>
The preferred format for the report is a PDF file. You can also use DOC or postscript formats or as an ipython notebook file.  As programming language we prefer that you choose between C/C++, Fortran2008 or Python. The following prescription should be followed when preparing the report:

<ul>
  <li> Use Devilry to hand in your projects, log in  at  <a href="http://devilry.ifi.uio.no" target="_blank"><tt>http://devilry.ifi.uio.no</tt></a> with your normal UiO username and password and choose either 'fys3150' or 'fys4150'. There you can load up the files within the deadline.</li>
  <li> Upload <b>only</b> the report file!  For the source code file(s) you have developed please provide us with your link to your github domain.  The report file should include all of your discussions and a list of the codes you have developed.  Do not include library files which are available at the course homepage, unless you have made specific changes to them.</li>
  <li> In your git repository, please include a folder which contains selected results. These can be in the form of output from your code for a selected set of runs and input parametxers.</li>
  <li> In this and all later projects, you should include tests (for example unit tests) of your code(s).</li>
  <li> Comments  from us on your projects, approval or not, corrections to be made  etc can be found under your Devilry domain and are only visible to you and the teachers of the course.</li>
</ul>

Finally, 
we encourage you to work two and two together. Optimal working groups consist of 
2-3 students. For this specific report you can  hand in a common report.

<p>

<!-- ------------------- end of main content --------------- -->


</body>
</html>
    

